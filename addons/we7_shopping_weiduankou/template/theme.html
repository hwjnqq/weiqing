{template 'common/header'}
{template 'common'}

<style>
	.template .item{position:relative;display:block;float:left;border:1px #ddd solid;border-radius:5px;background-color:#fff;padding:5px;width:190px;margin:0 20px 20px 0; overflow:hidden;}
	.template .title{margin:5px auto;line-height:2em;}
	.template .title a{text-decoration:none;}
	.template .item img{width:178px;height:270px; cursor:pointer;}
	.template .active.item-style img, .template .item-style:hover img{width:178px;height:270px;border:3px #009cd6 solid;padding:1px; }
	.template .title .fa{display:none}
	.template .active .fa.fa-check{display:inline-block;position:absolute;bottom:33px;right:6px;color:#FFF;background:#009CD6;padding:5px;font-size:14px;border-radius:0 0 6px 0;}
	.template .fa.fa-times{cursor:pointer;display:inline-block;position:absolute;top:10px;right:6px;color:#D9534F;background:#ffffff;padding:5px;font-size:14px;text-decoration:none;}
	.template .fa.fa-times:hover{color:red;}
	.template .item-bg{width:100%; height:342px; background:#000; position:absolute; z-index:1; opacity:0.5; margin:-5px 0 0 -5px;}
	.template .item-build-div1{position:absolute; z-index:2; margin:-5px 10px 0 5px; width:168px;}
	.template .item-build-div2{text-align:center; line-height:30px; padding-top:150px;}
</style>
<div class="clearfix template">
	<div class="panel panel-default">
		<nav role="navigation" class="navbar navbar-default navbar-static-top" style="margin-bottom:0;">
			<div class="container-fluid">
				<div class="navbar-header">
					<a href="javascript:;" class="navbar-brand">商城模板</a>
				</div>
			</div>
		</nav>
		<div class="panel-body">
			{loop $themes $theme}
			<div class="item item-style">
				<div class="title">
					<div style="overflow:hidden; height:28px;">商城模板 {$theme}</div>
					<a href="javascript:;">
						<img src="{$_W['siteroot']}addons/{php echo $this->module['name']}/template/mobile/{$theme}/preview.jpg" class="img-rounded">
					</a>
					<span class="fa fa-check"></span>
				</div>
				<div class="btn-group  btn-group-justified">
					<a href="javascript:;" onclick="preview('{$theme}');return false;" class="btn btn-default btn-xs">预览</a>
					{if $theme == $themesetting}
					<a href="javascript:;" class="btn btn-success btn-xs">已启用</a>
					{else}
					<a href="{php echo $this->createWebUrl('theme', array('theme' => $theme));}" class="btn btn-default btn-xs">启用</a>
					{/if}
				</div>
			</div>
			{/loop}
		</div>
	</div>
</div>

<script type="text/javascript">
	require(['bootstrap'],function($){
		$('.item .item-build-btn').popover();
	});
	// 商城模板预览
	function preview(theme) {
		require(['jquery', 'util'], function($, u){
			var exp = new Date();
			exp.setTime(exp.getTime() + 5000);
			document.cookie = "theme=" + theme + ";path=/;expires=" + exp.toGMTString();
			var content = '<iframe width="320" scrolling="yes" height="480" frameborder="0" src="about:blank"></iframe>';
			var footer = '<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>';
			var dialog = u.dialog('预览模板', content, footer);
			var url = "{$_W['siteroot']}app{php echo ltrim($this->createMobileUrl('list'), '.')}";
			dialog.find('iframe').attr('src', url);
			dialog.find('.modal-dialog').css({'width': '322px'});
			dialog.find('.modal-body').css({'padding': '0', 'height': '480px'});
			dialog.modal('show');
		});
	}
</script>

{template 'common/footer'}