{template 'common/header'}
{php load()->func('tpl')}
<div class="main">
	{if $operation == 'post'}
	<ul class="nav nav-tabs">
		<li><a href="{php echo $this->createWebUrl('advertisement', array('op' => 'display'));}">管理</a></li>
		<li {if intval($_GPC['id'])==0}class="active"{/if}><a href="{php echo $this->createWebUrl('advertisement', array('op' => 'post'));}">创建广告</a></li>
		{if intval($_GPC['id'])!=0}
		<li class="active"><a href="{php echo $this->createWebUrl('advertisement', array('op'=>'post','id'=>$item['id']));}">编辑广告</a></li>
		{/if}
	</ul>
	<form action="" class="form-horizontal form" method="post" enctype="multipart/form-data">
		<input type="hidden" name="id" value="{$item['id']}">
		<div class="panel panel-default">
			<div class="panel-heading">
				广告信息
			</div>
			<div class="panel-body">
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">广告内容</label>
					<div class="col-sm-9 col-xs-12">
						<textarea style="height:100px;" class="richtext-clone" name="content" cols="70">{$item['content']}</textarea>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">外链</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" name="url" value="{$item['url']}" class="form-control" placeHolder="如果有,请输入外部链接"/>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">有效日期</label>
					<div class="col-sm-9 col-xs-12">
						{php echo tpl_form_field_daterange('datelimit',array('starttime'=>date('Y-m-d', $item['starttime']),'endtime'=>date('Y-m-d', $item['endtime'])))}
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">发布小区</label>
					<div class="col-sm-9 col-xs-12">
						{loop $regions $region}
						<label for="ipt_region_{$region['id']}" class="checkbox-inline">
							<input class="" name="region[]" value="{$region['id']}" id="ipt_region_{$region['id']}" type="checkbox" {if is_array($regionids) && in_array($region['id'], $regionids)}checked='checked'{/if} />{$region['title']}
						</label>
						{/loop}
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">广告状态</label>
					<div class="col-sm-9 col-xs-12">
						<label for="ipt_status" class="checkbox-inline">
							<input class="" name="status" id="ipt_status" type="checkbox" {if intval($item['status'])==1}checked='checked'{/if} />启用
						</label>
						<span class="help-block">控制公告在住户端显示状态</span>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">创建人</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" value="{$item['creator']}" class="form-control" readonly="readonly"/>
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-3 col-md-2 control-label">创建时间</label>
					<div class="col-sm-9 col-xs-12">
						<input type="text" value="{php echo date('Y-m-d', $item['createtime'])}" class="form-control" readonly="readonly"/>
					</div>
				</div>
				<div class="form-group col-sm-12">
					<input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1" />
					<input type="hidden" name="token" value="{$_W['token']}" />
				</div>
			</div>
		</div>
	</form>
	<script type="text/javascript">
		require(['util'],function(util){
			util.editor( $("textarea[name=content]")[0]);
		})
	</script>
	{elseif $operation == 'display'}
	<ul class="nav nav-tabs">
		<li class="active"><a href="{php echo $this->createWebUrl('advertisement', array('op' => 'display'));}">管理</a></li>
		<li><a href="{php echo $this->createWebUrl('advertisement', array('op' => 'post'));}">创建广告</a></li>
	</ul>
	<div class="panel panel-info">
		<div class="panel-heading">筛选</div>
		<div class="panel-body">
			<form action="./index.php" method="get" class="form-horizontal" role="form">
				<input type="hidden" name="c" value="site" />
				<input type="hidden" name="a" value="entry" />
				<input type="hidden" name="m" value="we7_community" />
				<input type="hidden" name="do" value="advertisement" />
				<input type="hidden" name="op" value="display" />
				<input type="hidden" name="status" value="{$_GPC['status']}" />
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">广告内容</label>
					<div class="col-xs-12 col-sm-8 col-lg-9">
						<input class="form-control" name="keyword"  type="text" value="{$_GPC['keyword']}">
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">发布时限</label>
					<div class="col-xs-12 col-sm-8 col-lg-9">
						{php echo tpl_form_field_daterange('datelimit',array('starttime'=>date('Y-m-d', $starttime),'endtime'=>date('Y-m-d', $endtime)))}
					</div>
				</div>
				<div class="form-group">
					<label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">广告状态</label>
					<div class="col-xs-12 col-sm-8 col-lg-9">
						<label for="ipt_status0" class="checkbox-inline">
							<input class="ipt_status1" name="status[]" id="ipt_status0" type="checkbox" value="0" {if in_array(0, $status)}checked='checked'{/if} />禁用
						</label>
						<label for="ipt_status1" class="checkbox-inline">
							<input class="ipt_status2" name="status[]" id="ipt_status1" type="checkbox" value="1" {if in_array(1, $status)}checked='checked'{/if} />启用
						</label>
					</div>
					<div class="col-sm-2">
						<button class="btn btn-default pull-right"><i class="fa fa-search"></i> 搜索</button>
					</div>
				</div>
			</form>
		</div>
	</div>
	<div class="panel panel-default">
		<div class="panel-body table-responsive">
			<table class="table table-hover">
				<thead class="navbar-inner">
				<tr>
					<th style="width:150px;">广告内容</th>
					<th style="width:100px;">发布位置</th>
					<th style="width:80px;">发布人</th>
					<th style="width:120px;">发布日期</th>
					<th style="width:120px;">有效日期</th>
					<th style="width:100px;;">状态</th>
					<th style="width:120px">操作</th>
				</tr>
				</thead>
				<tbody>
				{loop $list $item}
				<tr>
					<td>{php echo cutstr(htmlspecialchars_decode($item['content']), 35, true)}</td>
					<td>{$item['region']}</td>
					<td>{$item['creator']}</td>
					<td>{php echo date('Y-m-d H:i:s', $item[createtime]);}</td>
					<td>{php echo date('Y-m-d', $item[starttime]);} ~ {php echo date('Y-m-d', $item[endtime]);}</td>
					<td>{if intval($item['status'])==1}启用{else}禁用{/if}</td>
					<td>
						<span>
							<a href="{php echo $this->createWebUrl('advertisement',array('op'=>'post','id'=>$item['id']))}" class="btn btn-default btn-sm" data-toggle="tooltip" data-placement="bottom" title="编辑"><i class="fa fa-edit"></i></a>&nbsp;
							<a href="{php echo $this->createWebUrl('advertisement',array('op'=>'delete','id'=>$item['id']))}" onclick="return confirm('此操作不可恢复，确认吗？');" class="btn btn-default btn-sm" data-toggle="tooltip" data-placement="bottom" title="删除"><i class="fa fa-times"></i></a>
						</span>
					</td>
				</tr>
				{/loop}
				</tbody>
			</table>
		</div>
	</div>
	{$pager}
	{/if}
</div>
<script>
	require(['bootstrap'],function($){
		$('.btn').tooltip();
	});
</script>
{template 'common/footer'}