{template 'common/header'}
{template 'nav'}
<div class="main">
{if $operation == 'display'}
<ul class="nav nav-tabs">
	{if !empty($this->module['config']['verify'])}
	<li><a href="{php echo $this->createWebUrl('member', array('op' => 'audit','regionid'=>$_GPC['regionid']));}">待审核</a></li>
	{/if}
	<li class="active"><a href="{php echo $this->createWebUrl('member', array('op' => 'display','regionid'=>$_GPC['regionid']));}">管理</a></li>
</ul>
<div class="panel panel-info">
	<div class="panel-heading">筛选</div>
	<div class="panel-body">
		<form action="./index.php" method="get" class="form-horizontal" role="form">
			<input type="hidden" name="c" value="site" />
			<input type="hidden" name="a" value="entry" />
			<input type="hidden" name="m" value="we7_community" />
			<input type="hidden" name="do" value="member" />
			<input type="hidden" name="op" value="display" />
			<input type="hidden" name="regionid" value="{$_GPC['regionid']}" />
			<input type="hidden" name="status" value="{$_GPC['status']}" />
			<div class="form-group">
				<label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">住户姓名</label>
				<div class="col-xs-12 col-sm-8 col-lg-9">
					<input class="form-control" name="realname"  type="text" value="{$_GPC['realname']}">
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">住户手机</label>
				<div class="col-xs-12 col-sm-8 col-lg-9">
					<input class="form-control" name="mobile"  type="text" value="{$_GPC['mobile']}">
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">住户身份</label>
				<div class="col-xs-12 col-sm-8 col-lg-9">
					<select name="type" class="form-control">
						<option value="0"{if intval($_GPC['type'])==0} selected{/if}>所有</option>
						<option value="1"{if intval($_GPC['type'])==1} selected{/if}>业主</option>
						<option value="2"{if intval($_GPC['type'])==2} selected{/if}>租客</option>
					</select>
				</div>
				<div class="col-sm-2">
					<button class="btn btn-default"><i class="fa fa-search"></i> 搜索</button>
				</div>
			</div>
		</form>
	</div>
</div>

<div class="panel panel-default">
	<div class="panel-body table-responsive">
	<table class="table table-hover">
		<thead class="navbar-inner">
		<tr>
			<th style="width:100px;">住户类型</th>
			<th style="width:100px;">住户姓名</th>
			<th style="width:100px;">住户手机</th>
			<th style="width:200px;">地址</th>
			<th style="width:100px;">状态</th>
			<th style="width:150px;">操作</th>
		</tr>
		</thead>
		<tbody>
		{loop $list $item}
		<tr>
			<td>{$types[$item['type']]}</td>
			<td>{$item['realname']}</td>
			<td>{$item['mobile']}</td>
			<td>{$item['address']}</td>
			<td>{if $item['status']}<span class="label label-success">通过</span>{else}<span class="label label-default">禁止</span>{/if}</td>
			<td>
				{if empty($item['status'])}<a href="{php echo $this->createWebUrl('member', array('op'=>'verify', 'status' => 1, 'regionid' => $regionid, 'id' => $item['id']));}" class="btn btn-default btn-sm">审核通过</a>&nbsp;{else}<a href="{php echo $this->createWebUrl('member', array('op'=>'verify', 'status' => 0, 'regionid' => $regionid, 'id' => $item['id']));}" class="btn btn-danger btn-sm">禁止用户</a>&nbsp;{/if}
				<a href="{php echo $this->createWebUrl('member', array('op'=>'post', 'id' => $item['id'], 'regionid' => $regionid));}" class="btn btn-default btn-sm">查看</a>&nbsp;
				<a onclick="return confirm('删除操作不可恢复，确认吗？')" href="{php echo $this->createWebUrl('member', array('op'=>'delete', 'id' => $item['id'], 'regionid' => $regionid));}" class="btn btn-default btn-sm">删除</a>
			</td>
		</tr>
		{/loop}
		</tbody>
	</table>
	</div>
</div>
{$pager}
{elseif $operation == 'audit'}
<ul class="nav nav-tabs">
	<li class="active"><a href="{php echo $this->createWebUrl('member', array('op' => 'audit','regionid'=>$_GPC['regionid']));}">待审核</a></li>
	<li><a href="{php echo $this->createWebUrl('member', array('op' => 'display','regionid'=>$_GPC['regionid']));}">管理</a></li>
</ul>
<form action="site.php" method="post">
	<input type="hidden" name="act" value="module" />
	<input type="hidden" name="op" value="audit" />
	<input type="hidden" name="do" value="member" />
	<input type="hidden" name="regionid" value="{$_GPC['regionid']}" />
	<input type="hidden" name="name" value="community" />
	<div class="panel panel-default">
		<div class="panel-body">
		<table class="table table-hover">
			<thead class="navbar-inner">
			<tr>
				<th style="width:40px;">选择</th>
				<th style="width:100px">住户类型</th>
				<th style="width:100px;">住户姓名</th>
				<th style="width:100px;">住户手机</th>
				<th style="width:200px;">地址</th>
				<th style="width:100px;">状态</th>
				<th style="width:150px;">操作</th>
			</tr>
			</thead>
			<tbody>
			{loop $list $item}
			<tr>
				<td><input type="checkbox" name="id[]" value="{$item['id']}" /></td>
				<td>{$types[$item['type']]}</td>
				<td>{$item['realname']}</td>
				<td>{$item['mobile']}</td>
				<td>{$item['address']}</td>
				<td>{if $item['status']}<span class="label label-success">通过</span>{else}<span class="label label-error">禁止</span>{/if}</td>
				<td>
					<a href="{php echo $this->createWebUrl('member', array('op'=>'post', 'id' => $item['id'], 'regionid' => $regionid,'ref'=>'audit'));}">查看</a>&nbsp;|&nbsp;
					<a onclick="return confirm('删除操作不可恢复，确认吗？')" href="{php echo $this->createWebUrl('member', array('op'=>'delete', 'id' => $item['id'], 'regionid' => $regionid,'ref'=>'audit'));}">删除</a>
				</td>
			</tr>
			{/loop}
			</tbody>
			<tbody>
			<tr>
				<td><input type="checkbox" id="checkAll" onclick="selectall(this, 'id')"/></td>
				<td colspan="6">
					{if !empty($needAudit)}
					<button type="submit" class="btn btn-primary span2" name="auditselected" value="auditselected">审核选中</button>
					<button type="submit" onclick="return confirm('审核所有的未审核用户，确认吗？')"  class="btn btn-primary span2" name="auditall" value="auditall">一键审核</button>
					{/if}
					<input type="hidden" name="token" value="{$_W['token']}" />
				</td>
			</tr>
			</tbody>
		</table>
		</div>
	</div>
	{$pager}
</form>
{elseif $operation == 'post'}
<ul class="nav nav-tabs">
	{if !empty($this->module['config']['verify'])}
	<li><a href="{php echo $this->createWebUrl('member', array('op' => 'audit','regionid'=>$_GPC['regionid']));}">待审核</a></li>
	{/if}
	<li><a href="{php echo $this->createWebUrl('member', array('op' => 'display','regionid'=>$_GPC['regionid']));}">管理</a></li>
	<li class="active"><a href="{php echo $this->createWebUrl('member', array('op' => 'post','regionid'=>$_GPC['regionid'],'id'=>$_GPC['id']));}">编辑</a></li>
</ul>
<form action="" class="form-horizontal form" method="post">
	<input type="hidden" name="id" value="{$member['id']}">
	<div class="panel panel-default">
		<div class="panel-heading">
			住户信息
		</div>
		<div class="panel-body">
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">姓名</label>
				<div class="col-sm-9 col-xs-12">
					<input name="realname" type="text" value="{$member['realname']}" class='form-control' />
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">手机</label>
				<div class="col-sm-9 col-xs-12">
					<input type="text" id="mobile" name="mobile" value="{$member['mobile']}"  class='form-control' />
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">我的身份</label>
				<div class="col-sm-9 col-xs-12">
					<select name="type"  class='form-control' >
						<option value="1"{if intval($member['type'])==1} selected{/if}>业主</option>
						<option value="2"{if intval($member['type'])==2} selected{/if}>租户</option>
					</select>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">小区</label>
				<div class="col-sm-9 col-xs-12">
					<select id="regionid" name="_regionid"  class='form-control' >
						{loop $regions $region}
						<option value="{$region['id']}" {if $member['regionid']==$region['id']}selected{/if}>{$region['title']}</option>
						{/loop}
					</select>
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">地址</label>
				<div class="col-sm-9 col-xs-12" class='form-control' >
					<input type="text" id="address" name="address" value="{$member['address']}"   class='form-control' />
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label">备注</label>
				<div class="col-sm-9 col-xs-12"  class='form-control' >
					<input type="text" id="remark" name="remark" value="{$member['remark']}"   class='form-control' />
				</div>
			</div>
			<div class="form-group">
				<label class="col-xs-12 col-sm-3 col-md-2 control-label"></label>
				<div class="col-sm-9 col-xs-12"  class='form-control' >
					<input type="submit" name="submit" value="提交" class="btn btn-primary col-lg-1" />
					<input type="hidden" name="token" value="{$_W['token']}" />
				</div>
			</div>
		</div>
	</div>
</form>
{/if}
</div>
{template 'common/footer'}