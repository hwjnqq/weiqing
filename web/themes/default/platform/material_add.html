{template 'common/header'}
<div class="main" ng-module="materialApp" ng-controller="materialAdd" id="main">
	<div class="container">
		<div class="penel we7-panel panel-special">
			<div class="panel-heading">
				<ol class="breadcrumb we7-breadcrumb">
					<a href=""><i class="fa fa-chevron-circle-left"></i> </a>
					<li>
						素材库
					</li>
					<li>
						新建图文素材
					</li>
				</ol>
			</div>
			<div class="panel-body">
				<div class="appmsg-edit-box">
					<div class="appmsg-preview-area">
						<div class="appmsg-edit-container appmsg-preview-container js-aside" style="height: 788px;">
							<div class="appmsg-container-hd">
								<h4 class="appmsg-container-title">图文列表</h4>
							</div>
							<div class="appmsg-container-bd">
								<div class="material-appmsg-item multi">
									<div class="appmsg-content">
										<div ng-repeat="material in materialList" ng-click="changeIndex($index)" ng-class="material.class">
											<h4 class="appmsg-title">
												<a href="" target="-blank">{{ material.title }}</a>
											</h4>
											<div class="appmsg-thumb" ng-style="{'background-image' : 'url('+material.thumb+')'}">
											</div>
											<div class="appmsg-edit-mask">
												<a onclick="return false;" class="sort-up" href="javascript:;" ng-click="changeOrder('up', $index)" title="上移" ng-if="$index != 0">向上</a>
												<a onclick="return false;" class="sort-down" href="javascript:;" ng-click="changeOrder('down', $index)" title="下移" ng-if="$index != (materialList.length - 1)">向下</a>
												<a onclick="return false;" class="del" href="javascript:;" ng-if="$index != 0 && operate == 'add'" ng-click="deleteMaterial($index)" title="删除">删除</a>
											</div>
										</div>
									</div>
								</div>
								<a title="添加一篇图文" ng-click="addMaterial()" ng-show="materialList.length < 8 && operate == 'add'" class="appmsg-add" href="javascript:void(0);" style="display: block;">
									<i class="add-gray">+</i>
								</a>
							</div>
						</div>
					</div>

					<div class="appmsg-input-area">
						<!--编辑头部-->
						<div class="input-area-head">
							头部占位
						</div>
						<!--end编辑头部-->
						<!--标题-->
						<div class="appmsg-edit-item title">
						<label for="title" class="" style="display:none">请在这里输入标题</label>
						<input id="title" placeholder="请在这里输入标题" class="form-control" name="title" ng-model="materialList[activeIndex].title" max-length="64" type="text">
						<em class="form-control-append">0/64</em>
					</div>
						<!--作者-->
						<div class="appmsg-edit-item author">
							<label for="author" class="" style="display:none">请输入作者</label>
							<input id="author" placeholder="请输入作者" class="form-control" ng-model="materialList[activeIndex].author" name="author" max-length="8" type="text">
							<em class="form-control-append">0/8</em>
						</div>
						<!--正文-->
						<div class="editor-area" ng-my-editor ng-my-value="materialList[activeIndex].content">
						</div>
						<div class="appmsg-edit-function-area ">
							<!-- BEGIN 原文链接 -->
							<div class="we7-form appmsg-edit-item origin-url-area">
								<div class="form-controls">
									<input id='check-1' type="checkbox" name='check-1' checked='checked' />
									<label for="check-1">展开链接</label>
								</div>
								<span class="form-control-box"><input class="form-control" name="source-url" ng-model="materialList[activeIndex].content_source_url" type="text" size="60"></span>
							</div>
							<!-- END 原文链接 -->
						</div>
						<div class="appmsg-edit-highlight-area">
							<div class="appmsg-edit-title">发布样式编辑</div>
							<!-- EBGIN 封面 -->
							<div class="appmsg-edit-item gap-left">
								<label for="" class="form-label">
									<strong class="title">封面</strong>
									<p class="tips gap-left">小图片建议尺寸：200像素 * 200像素</p>
								</label>
								<div class="upload-wrap clearfix">
									<div class="">
										<a  href="javascript:void(0);" class="btn btn-default">从正文选择</a>
										&nbsp;&nbsp;
										<a  href="javascript:void(0);" class="btn btn-default" ng-click="pickPicture()">从图片库选择</a>
									</div>
									<image ng-src="{{ materialList[activeIndex].thumb }}"></image>
								</div>
							</div>
							<!-- END 封面 -->
							<!-- BEGIN 摘要 -->
							<div class="appmsg-edit-item gap-left appmsg-description">
								<label for="" class="frm-label">
									<strong class="title" ng-click="zhaiyao()">摘要</strong>
									<p class="tips l gap-left">选填，如果不填写会默认抓取正文前54个字</p>
								</label>
									<span class="form-textarea-box">
									<textarea class="form-textarea" ng-model="materialList[activeIndex]['digest']" name="digest" max-length="120" rows="4" ></textarea>
									<em class="form-control-append">0/120</em>
									</span>
								<div class="frm-msg fail""></div>
						</div>
						<!-- END 摘要 -->
					</div>
				</div>
			</div>
		</div>
	</div>
	<nav class="navbar navbar-wxapp-bottom navbar-fixed-bottom" role="navigation">
		<div class="container">
			<div class="pager">
				<a type="button" class="btn btn-default pull-left">收起正文</a>
				<div class="pull-right">
					<a type="button" class="btn btn-primary" ng-click="saveNews()">保存</a>
					<a type="button" class="btn btn-default">预览</a>
					<a type="button" class="btn btn-default">保存并群发</a>
				</div>
			</div>
		</div>
	</nav>
</div>
<script>
	require(['underscore', 'fileUploader'], function() {
		angular.module('materialApp').value('material', {
			'materialList' : {php echo json_encode($news_list)},
			'operate' : {if !empty($_GPC['newsid'])}'edit'{else}'add'{/if},
			'url' : '{php echo url('platform/material_add/tomedia')}',
			'newsUpload_url' : '{php echo url('platform/material_add/addnews')}',
			'msg_url' : '{php echo url('platform/material/display')}',
			'upload_thumb_url' : '{php echo url('platform/material_add/thumb_upload')}',
			'upload_iamge_url' : '{php echo url('platform/material_add/image_upload')}'
		});
		angular.bootstrap($('#main'), ['materialApp']);
	});
</script>
{template 'common/footer'}