{template 'common/header'}
<div class="we7-page-title">微官网</div>
<ul class="we7-page-tab">
	<li><a href="{php echo url('platform/site/wesite')}">微官网列表</a></li>
	<li><a href="{php echo url('platform/site/wesite_tpl')}">微官网模板</a></li>
	<li><a href="{php echo url('platform/site/article')}">文章管理</a></li>
	<li class="active"><a href="{php echo url('platform/site/article', array('operation' => 'display_category'))}">文章分类管理</a></li>
</ul>
<div class="we7-page-search we7-padding-bottom clearfix">
	<div class="pull-right">
		<a href="{php echo url('platform/site/article', array('operation' => 'edit_category'))}" class="btn btn-primary we7-padding-horizontal">+新建文章分类</a>
	</div>
</div>
<table class="tabel we7-table article-list" id="js-wesite-category-display">
	<col width="5px">
	<col width="70px"/>
	<col>
	<col width="90px"/>
	<col width="300px"/>
	<tr>
		<th></th>
		<th>排序</th>
		<th class="text-left">分类名称</th>
		<th>设为栏目</th>
		<th>操作</th>
	</tr>
	<form action="./index.php?c=platform&a=site&do=article&operation=del_category" method="post">
	{loop $category $row}
		<tr>
			<td><input type="checkbox" name="rid[]" value="{$row['id']}"></td>
			<td class="text-center">{$row['displayorder']}</td>
			<td class="text-left">
				<span>{$row['name']}</span>
				{if empty($row['parentid'])}
					<a href="{php echo url('platform/site/article', array('operation' => 'edit_category', 'parentid' => $row['id']))}" class="color-default we7-margin-right-sm">&nbsp;+添加子分类</a>
				{/if}
			</td>
			<td><span>{php echo $row['nid'] ? '是' : '否'}</span></td>
			<td style="position:relative;">
				<a href="javascript:;" data-url="{php echo murl('site/site', array('cid' => $row['id']), true, true)}" class="js-clip color-default we7-margin-right-sm">复制链接</a>
				<a href="{php echo url('platform/site/article', array('operation' => 'edit_article', 'pcate' => $row['id']));}" class="color-default we7-margin-right-sm">添加文章</a>
				<a href="{php echo url('platform/site/article', array('operation' => 'edit_category', 'id' => $row['id']));}" class="color-default we7-margin-right-sm">编辑</a>
				<a href="{php echo url('platform/site/article', array('operation' => 'del_category', 'id' => $row['id']));}" class="color-default" onclick="return confirm('确认删除此分类吗？');return false;">删除</a>
			</td>
		</tr>
		{loop $children[$row['id']] $row}
		<tr>
			<td><input type="checkbox" name="rid[]" value="{$row['id']}"></td>
			<td class="text-center">{$row['displayorder']}</td>
			<td class="text-left"><span class="color-gray">---&nbsp;&nbsp;</span>{$row['name']}</td>
			<td><span>{php echo $row['enabled'] ? '是' : '否'}</span></td>
			<td style="position:relative;">
				<a href="javascript:;" data-url="{php echo murl('site/site', array('cid' => $row['id']), true, true)}" class="color-default we7-margin-right-sm js-clip">复制链接</a>
				<a href="{php echo url('platform/site/article', array('operation' => 'edit_article', 'pcate' => $row['parentid'], 'ccate' => $row['id']));}" class="color-default we7-margin-right-sm">添加文章</a>
				<a href="{php echo url('platform/site/article', array('operation' => 'edit_category', 'id' => $row['id'], 'parentid' => $row['parentid']));}" class="color-default we7-margin-right-sm">编辑</a>
				<a href="{php echo url('platform/site/article', array('operation' => 'del_category', 'id' => $row['id']));}" class="color-default" onclick="return confirm('确认删除此分类吗？');return false;">删除</a>
			</td>
		</tr>
		{/loop}
	{/loop}
		<tr>
			<td colspan="2">
				<input type="checkbox" name="select_all" id="select_all" value="1" style="margin-left:-10px">
				<input type="submit" class="btn btn-danger" name="submit" value="删除" onclick="if(!confirm('确定删除选中的规则吗？')) return false;"/>
				<input type="hidden" name="token" value="{$_W['token']}" />			
			</td>
		</tr>
	</form>
</table>
<script>
$('#select_all').click(function(){
	$('.article-list :checkbox').prop('checked', $(this).prop('checked'));
});
$('.js-clip').each(function(){
	util.clip(this, $(this).attr('data-url'));
});
</script>
{template 'common/footer'}