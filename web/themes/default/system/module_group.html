{template 'common/header'}
{if $do == 'display'}
<div class="js-system-module_group" ng-controller="moduleGroupCtrl" ng-cloak>
	<div class="combo-list">
		<div class="we7-page-title">
			应用权限套餐
		</div>

		<ul class="we7-page-tab">
			<li class="active"><a href="套餐应用列表.html">应用权限套餐列表  </a></li>
			<li ><a href="">销售记录</a></li>
		</ul>

		<div class="we7-page-search clearfix">
			<form action="" method="get" class="pull-left">
				<input type="hidden" name="c" value="system">
				<input type="hidden" name="a" value="module_group">
				<input type="hidden" name="do" value="display">
				<div class="input-group we7-margin-bottom">
					<input class="form-control" name="name" value="{$_GPC['name']}" type="text" placeholder="" >
					<span class="input-group-addon"><button class="button"><i class="fa fa-search"></i></button></span>
				</div>
			</form>
			<div class="pull-right">
				<a href="添加套餐应用列表.html" class="btn btn-primary">+添加应用权限套餐</a>
			</div>
		</div>
		<table class="table we7-table vertical-middle">

			<col width="190px" />
			<col />
			<col width="140px" />
			<col width="275px" />
			<col width="210px" />
			<tr>
				<th class="text-left">套餐名称</th>
				<th>应用个数</th>
				<th>模块个数</th>
				<th>用户权限组</th>
				<th class="text-left">操作</th>
			</tr>
			<tr >
				<td class="text-left">基础服务</td>
				<td>基础回复模块</td>
				<td>微站默认模板</td>
				<td></td>
				<td class="text-left">
					<div class="link-group">
						<a href="javasrcript:;" class="color-default js-unfold" data-toggle="collapse" data-target="#extend1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
						<a href="">编辑套餐</a>
						<a href="">删除</a>
					</div>
				</td>
			</tr>
			<tr >
				<td class="text-left">所有服务</td>
				<td>系统所有模块</td>
				<td>系统所有模板</td>
				<td></td>
				<td class="text-left">
					<div class="link-group">
						<a href="javasrcript:;" class="color-default js-unfold" data-toggle="collapse" data-target="#extend1">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
						<a href="">编辑套餐</a>
						<a href="">删除</a>
					</div>
				</td>
			</tr>

			{loop $modules_group_list $module_group}
			<tr >
				<td class="text-left">{$module_group['name']}</td>
				<td>{php echo count($module_group['modules'])}</td>
				<td>{php echo count($module_group['templates'])}</td>
				<td>超级VIP</td>
				<td class="text-left">
					<div class="link-group">
						<a href="#toggle-{$module_group['id']}" class="color-default js-unfold" data-toggle="collapse" target="" ng-click="changeText($event)">展开</a>
						<a href="">编辑套餐</a>
						<a href="">删除</a>
					</div>
				</td>
			</tr>
			<div class="collapse bg-light-gray" id="toggle-{$module_group['id']}">
			<tr>
				<td colspan="5">
					<div class="col-sm-1 color-gray text-left we7-padding-none">应用</div>
					<div class="col-sm-11">
						{loop $module_group['modules'] $module}
						<div class="col-sm-3 text-left">
							<a href=""><img style="height: 50px;width: 50px;" src="{if file_exists('../framework/addons/' . $module['name'] . '/icon-custom.jpg')}{php echo tomedia('../framework/addons/' . $module['name'] . '/icon-custom.jpg')}{else}{php echo tomedia('../framework/addons/' . $module['name'] . '/icon.jpg')}{/if}" alt="">{$module['title']}</a>
						</div>
						{/loop}
					</div>
				</td>
			</tr>
			<tr class="collapse bg-light-gray toggle-{$module_group['id']}" aria-expanded="true" >
				<td colspan="5">
					<div class="col-sm-1 color-gray text-left we7-padding-none">模板</div>
					<div class="col-sm-11">
						{loop $module_group['templates'] $template}
						<div class="col-sm-3 text-left">
							<a href="">{$template['title']}</a>
						</div>
						{/loop}
					</div>
				</td>
			</tr>
			{/loop}
		</table>
	</div>
</div>
<script>
	angular.bootstrap($('.js-system-module_group'), ['moduleApp']);
</script>
{elseif $do == 'post'}
<form action="{php echo url('system/module_group/post')}" method="post">
	<div class="form-group">
		<label class="col-xs-12 col-sm-2 col-md-2 col-lg-1 control-label">服务套餐名称</label>
		<div class="col-sm-10 col-xs-12">
			<input type="text" class="form-control" name="name" id="name" value="{$module_group['name']}" />
		</div>
	</div>
	<table class="table">
		<thead>
		<th style="width:120px;"><input type="checkbox" id="template" onclick="checkall('template')">(全选)选择</th>
		<th style="width:120px;">名称</th>
		<th>标识</th>
		<th>简介</th>
		</thead>
		<tbody>
		{loop $template_list $template}
		<tr>
			<td><input type="checkbox" name="template[]" value="{$template['id']}" {if !empty($module_group['template']) && in_array($template['id'], $module_group['templates'])}checked{/if}></td>
			<td>{$template['title']}</td>
			<td>
				{$template['name']}
			</td>
			<td>
				{$template['description']}
			</td>
		</tr>
		{/loop}
		</tbody>
	</table>

	<table class="table">
		<thead>
			<th style="width:120px;"><input type="checkbox" id="module" onclick="checkall('module')">(全选)选择</th>
			<th style="width:120px;">名称</th>
			<th>标识</th>
			<th>简介</th>
		</thead>
		<tbody>
		{loop $module_list $module}
		<tr>
			<td><input type="checkbox" name="module[]" value="{$module['mid']}" {if !empty($module_group['template']) && in_array($module['name'], $module_group['modules'])}checked{/if}></td>
			<td>{$module['title']}</td>
			<td>
				{$module['name']}
			</td>
			<td>
				{$module['description']}
			</td>
		</tr>
		{/loop}
		</tbody>
	</table>
	<input name="submit" value="提交" class="btn btn-primary" type="submit">
	<input name="token" value="{$_W['token']}" type="hidden">
	<input name="id" value="{$module_group['id']}" type="hidden">
</form>
{/if}
{template 'common/footer'}