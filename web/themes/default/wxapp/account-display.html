{template 'common/header'}
<div class="panel panel-cut">
	<div class="panel-heading">
		选择小程序
	</div>
	<div class="panel-body">
		{if !$_W['isfounder'] && !empty($account_info['wxapp_limit'])}
			<div class="alert alert-warning">
				温馨提示：
				<i class="fa fa-info-circle"></i>
				Hi，<span class="text-strong">{$_W['username']}</span>，您所在的会员组： <span class="text-strong">{$account_info['group_name']}</span>，
				账号有效期限：<span class="text-strong">{php echo date('Y-m-d', $_W['user']['starttime'])} ~~ {if empty($_W['user']['endtime'])}无限制{else}{php echo date('Y-m-d', $_W['user']['endtime'])}{/if}</span>，
				可创建 <span class="text-strong">{$account_info['maxwxapp']} </span>个小程序，已创建<span class="text-strong"> {$account_info['wxapp_num']} </span>个，还可创建 <span class="text-strong">{$account_info['wxapp_limit']} </span>个小程序。
			</div>
		{/if}
		<div class="wxapp-manage">
			{if !empty($account_info['wxapp_limit']) || $_W['isfounder']}
			<a href="{php echo url('wxapp/post/design_method')}" class="color-default"><i class="wi wi-registersite"></i>新建小程序</a>
			{/if}
		</div>
		<div class="cut-list clearfix we7-margin-top" id="js-wxapp-account-display" ng-controller="AccountDisplayWxappCtrl" ng-cloak>
			<div class="item wxapp-list-item" ng-repeat="list in wxapp_lists" ng-if="wxapp_lists">
				<div class="content">
					<img ng-src="{{list.thumb}}" class="icon"/>
					<div class="name text-over" ng-bind="list.name"></div>
				</div>
				<div class="version">
					<span class="name">版本</span>
					<div class="version-detail" ng-bind="list.current_version.version"></div>
				</div>
				<div class="mask">
					<a ng-href="{{links.switch}}&uniacid={{list.uniacid}}&multiid={{list.current_version.multiid}}&version_id={{list.current_version.id}}" class="entry">
						<div>进入小程序 <i class="wi wi-angle-right"></i></div>
					</a>
					<a href="javascript:;" class="cut-btn" ng-click="showVersions($event)">
						<i class="wi wi-changing-over"></i>
					</a>
					<a href="{{links.rank}}&uniacid={{list.uniacid}}" class="stick" title="置顶">
						<i class="wi wi-stick-sign"></i>
					</a>
				</div>
				<div class="cut-select" ng-mouseleave="hideSelect($event)" ng-if="list.versions">
					<div class="arrow-left"></div>
					<div class="cut-item">
						<a href="javascript:;">
							<div class="detail" ng-repeat="version in list.versions">
								<div class="text-over"><span class="wi wi-small-routine"></span>{{version.version}}</div>
								<a class="cut-select-mask" href="{{links.switch}}&uniacid={{list.uniacid}}&multiid={{version.multiid}}&version_id={{version.id}}">
									<div class="entry">选择进入 <i class="wi wi-angle-right"></i></div>
								</a>
							</div>
						</a>
					</div>
					<div class="cut-select-pager">
						<a href="javascript:;" class="pre" ng-click="prevPage()">
							<span class="wi wi-angle-up"></span>
						</a>
						<a href="javascript:;" class="next" ng-click="nextPage()">
							<span class="wi wi-angle-down"></span>
						</a>
					</div>
				</div>
			</div>
			<div class="text-center we7-padding-vertical font-lg"  ng-if="!wxapp_lists">动动小手，点击右上角按钮，新建一个小程序吧！</div>
		</div>
		<div class="text-right">
			{$pager}
		</div>
	</div>
</div>
<script>
require(['underscore'], function() {
	angular.module('wxApp').value('config', {
		'wxapp_lists': {php echo !empty($wxapp_lists) ? json_encode($wxapp_lists) : 'null'},
		'links': {
			'rank': "{php echo url('wxapp/display/rank')}",
			'switch': "{php echo url('wxapp/display/switch', array('uniacid' => $list['uniacid'], 'multiid' => $list['versions']['multiid'], 'version_id' => $list['versions']['id']))}",
		},
	});
angular.module('wxApp').controller('AccountDisplayWxappCtrl', ['$scope', 'config', function($scope, config) {
	$scope.wxapp_lists = config.wxapp_lists;
	$scope.links = config.links;
	$scope.currentPage = 1;
	console.log($scope.wxapp_lists);
	$scope.showVersions = function(ev) {
		var cutSelect = $(ev.target).parents('.mask').next('.cut-select');
		if (cutSelect.css('display') == 'none') {
			cutSelect.css('display', 'block');
			cutSelect.parent('.wxapp-list-item').siblings().find('.cut-select').css('display', 'none');
		} else {
			cutSelect.css('display', 'none');
		}
	};

	$scope.hideSelect = function(ev) {
		console.log($(ev.target));
		$(ev.target).css('display', 'none');
	};

	$scope.nextPage = function() {
		
	};

	$scope.prevPage = function() {

	};
}]);
	angular.bootstrap($('#js-wxapp-account-display'), ['wxApp']);
});
</script>
{template 'common/footer'}