{template 'common/header'}

<div class="we7-page-title">用户管理 </div>
<ul class="we7-page-tab">
	<li><a href="{url 'user/display'}">用户管理 </a></li>
	<li class="active"><a href="{url 'user/recycle/display'}">用户回收站</a></li>
	<li><a href="{url 'user/fields/display'}">用户属性设置</a></li>
	<li><a href="{url 'user/registerset'}">用户注册设置</a></li>
</ul>
<div class="keyword-list-head clearfix we7-margin-bottom">
		<form action="" method="get">
			<input type="hidden" name="c" value="user">
			<input type="hidden" name="a" value="display">
			<div class="input-group pull-left" style="width: 400px;">
				<input type="text" name="username" id="" value="{$_GPC['username']}" class="form-control" placeholder="搜索用户名"/>
				<span class="input-group-addon"><button class="button"><i class="fa fa-search"></i></button></span>
			</div>
		</form>
	</div>                                                                                              
	<table class="table we7-table">
		<col width="100px"/>
		<col width="110px"/>
		<col width="110px"/>
		<col width="110px"/>
		<col width="66px"/>
		<col width="111px"/>
		<col width="203px"/>
		<tr>
			<th class="text-left">用户名</th>
			<th>用户权限组</th>
			<th>创建公众号</th>
			<th>使用公众号</th>
			<th>应用</th>
			<th>到期时间</th>
			<th class="text-left">操作</th>
		</tr>
	{loop $users $user}
		<tr>
			<td class="text-left">{$user['username']}</td>
			<td><span class="color-default">
					{if $user['founder']}
						<span class="color-default">管理员</span>
					{elseif isset($usergroups[$user['groupid']])}
						<span class="color-default">{$usergroups[$user['groupid']]['name']}</span>
					{else}
						<span class="color-default">未分配</span>
					{/if}
				</span>
			</td>
			<td class="color-default">{$usergroups[$user['groupid']]['maxaccount']}</td>
			<td class="color-default">{$user['uniacid_num']}</td>
			<td class="color-default">
				{if empty($user['founder'])}
					{$user['module_nums']}
				{/if}
				{if !empty($user['founder'])}
					全部
				{/if}
			</td>
			<td>
				{if empty($user['endtime'])}
					<span class="">永久有效</span>
				{elseif  $user['endtime'] != 0 && $user['endtime'] <= TIMESTAMP}
					<span class="">服务已到期</span>
				{elseif  $user['endtime'] != 0 && $user['endtime'] >= TIMESTAMP}
				{php echo date('Y-m-d', $user['endtime'])}
				{/if}
			</td>
			<td class="text-left">
				<div class="link-group">
				{if empty($user['founder'])}
					<a href="javascript:;" onclick="u.restore('{$user['uid']}');">启用</a>
					<a href="javascript:;" onclick="u.del('{$user['uid']}');">删除</a>
				{/if}
				</div>
			</td>
		</tr>
	{/loop}
	</table>
	{$pager}
</div>
<script type="text/javascript">
	var u ={};
	u.restore = function(uid){
		var uid = parseInt(uid);
		if(isNaN(uid)) {
			return;
		}
		if(!confirm('确认要启用此用户吗? ')) {
			return;
		}
		$.post('{php echo url('user/recycle');}', {'do': 'restore', uid: uid}, function(dat){
			if(dat == 'success') {
				location.href = location.href;
			} else {
				util.message('操作失败, 请稍后重试. ' + dat);
			}
		});
	};
	u.del = function(uid){
		var uid = parseInt(uid);
		if(isNaN(uid)) {
			return;
		}
		if(!confirm('确认要删除此用户吗? ')) {
			return;
		}
		$.post('{php echo url('user/recycle');}', {'do': 'delete', uid: uid}, function(dat){
			if(dat == 'success') {
				location.href = location.href;
			} else {
				util.message('操作失败, 请稍后重试. ' + dat);
			}
		});
	};
</script>
{template 'common/footer'}
