{template 'common/header'}
<div class="we7-page-title">
	参数设置
</div>
<ul class="we7-page-tab">
	<li>
		<a href="{php echo url('profile/payment')}">支付参数</a>
	</li>
	<li{if $do == 'oauth'} class="active"{/if}>
	<a href="{php echo url('profile/passport')}">借用权限</a>
	</li>
	<li>
		<a href="{php echo url('profile/tplnotice')}">微信通知设置</a>
	</li>
	<li>
		<a href="{php echo url('profile/notify')}">邮件通知参数</a>
	</li>
	<li{if $do == 'credit'} class="active"{/if}>
	<a href="{php echo url('profile/passport/credit')}">积分设置</a>
	</li>
	<li{if $do == 'fans_sync'} class="active"{/if}>
	<a href="{php echo url('profile/passport/fans_sync')}">粉丝同步设置</a>
	</li>
	<li{if $do == 'register'} class="active"{/if}>
	<a href="{php echo url('profile/passport/register')}">注册设置</a>
	</li>
</ul>

{if $do == 'oauth'}

<div id="js-profile-passport" ng-controller="oauthCtrl" ng-cloak>
	<table class="table we7-table table-form">
		<col width="140px " />
		<col />
		<col width="100px" />
		<tr>
			<th class="text-left" colspan="3">公众平台oAuth设置</th>
		</tr>
		<tr>
			<td class="text-left">
				选择公众号
			</td>
			<td class="text-left">
				{{ oauthtitle }}
			</td>
			<td class="text-left ">
				<a href="javascript:;" class="color-default" data-toggle="modal" data-target="#oauth">修改</a>
			</td>
		</tr>
		<tr>
			<td class="text-left">
				oAuth独立域名
			</td>
			<td class="text-left">
				{{ originalHost }}
			</td>
			<td class="text-left">
				<a href="javascript:;" class="color-default" data-toggle="modal" data-target="#host">修改</a>
			</td>
		</tr>
	</table>
	<div class="modal fade" id="oauth" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="we7-modal-dialog modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
					<div class="modal-title">选择公众号</div>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<select ng-model="oauthAccount" class="we7-select">
							<option value="" ng-selected="oauthAccount == ''">请选择公众号</option>
							<option value="{{ key }}" ng-selected="key == oauthAccount" ng-repeat="(key,account) in oauthAccounts track by key">{{ account }}</option>
						</select>
						<span class="help-block">在微信公众号请求用户网页授权之前，开发者需要先到公众平台网站的【开发者中心】<b>网页服务</b>中配置授权回调域名。<a href="http://www.we7.cc/manual/dev:v0.6:qa:mobile_redirect_url_error" target="_black" class="color-default">查看详情</a></span>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="saveOauth('oauth')">确定</button>
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="host" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="we7-modal-dialog modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
					<div class="modal-title">oAuth独立域名</div>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<input type="text"  name="host" ng-model="oauthHost" class="form-control" placeholder="oAuth独立域名">
						<span class="help-block">适用于您的微站或是活动有多个域名的情况下，由此域名做统一的oauth授权用。例如：http://www.baidu.com 注意：结尾没有 / </span>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="saveOauth('oauth')">确定</button>
					<button type="button" class="btn btn-default" data-dismiss="modal" ng-click="recover()">取消</button>
				</div>
			</div>
		</div>
	</div>
	<table class="table we7-table table-form">
		<col width="140px " />
		<col />
		<col width="100px" />
		<tr>
			<th class="text-left" colspan="3">借用 JS 分享设置</th>
		</tr>
		<tr>
			<td class="text-left">
				选择公众号
			</td>
			<td class="text-left">
				{{ jsOauthtitle }}
			</td>
			<td class="text-left ">
				<a href="javascript:;" class="color-default" data-toggle="modal" data-target="#jsauth_acid">修改</a>
			</td>
		</tr>
	</table>
	<div class="modal fade" id="jsauth_acid" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="we7-modal-dialog modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
					<div class="modal-title">选择公众号</div>
				</div>
				<div class="modal-body">
					<div class="form-group">
						<select name="jsauth_acid" ng-model="jsOauthAccount" class="we7-select">
							<option value="{{ key }}" ng-repeat="(key,account) in jsOauthAccounts track by key">{{ account }}</option>
						</select>
						<span class="help-block">在系统中使用微信分享接口前，开发者需要先到公众平台网站的【公众号设置】 / 【功能设置】中配置 【JS 接口安全域名】。<a href="http://www.we7.cc/manual/dev:v0.6:qa:jsauth" target="_black">查看详情</a></span>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" data-dismiss="modal" ng-click="saveOauth('jsoauth')">确定</button>
					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				</div>
			</div>
		</div>
	</div>
</div>
<script>
	angular.module('profileApp').value('config', {
		'oauthAccount' : "{$oauth['account']}",
		'oauthHost' : "{$oauth['host']}",
		'jsOauth' : "{$jsoauth}",
		'oauthAccounts' : {php echo json_encode($oauth_accounts)},
		'jsOauthAccounts' : {php echo json_encode($jsoauth_accounts)},
		'oauth_url' : "{php echo url('profile/passport/save_oauth')}",
		'get_setting_url' : "{php echo url('profile/passport/get_setting')}"
	});
	angular.bootstrap($('#js-profile-passport'), ['profileApp']);
</script>

{elseif $do == 'credit'}

<div id="js-profile-credit" ng-controller="creditCtrl" ng-cloak>
	<table class="table we7-table table-form">
		<col width="140px " />
		<col />
		<col width="140px" />
		<tr>
			<th class="text-left" colspan="5">支付参数</th>
		</tr>
		<tr ng-repeat="(key, credit) in creditSetting  track by key">
			<td >{{ key }}</td>
			<td style="width: 80px;">{{ credit.title }}</td>
			<td><a href="javascript:;" style="width: 500px;color: #0000ff;" ng-click="editCreditName(key)">设置名称</a></td>
			<td>
				{{ credit.enabled == 1 ? '开启' : '关闭' }}
			</td>
			<td class="text-center">
				<label>
					<input name="" class="form-control" type="checkbox"  style="display: none;">
					<div ng-class="credit.enabled == 1 ? 'switch switchOn' : 'switch'" ng-if="key != 'credit1' && key != 'credit2'"  ng-click="changeEnabled(key)"></div>
					<div ng-class="credit.enabled == 1 ? 'switch switchOn' : 'switch'" ng-if="key == 'credit1' || key == 'credit2'" style="opacity : 0.3"></div>
				</label>
			</td>
		</tr>
	</table>

	<table class="table we7-table table-form">
		<col width="140px " />
		<col />
		<col width="140px" />
		<tr>
			<th class="text-left" colspan="3">积分策略</th>
		</tr>
		<tr>
			<td >基本和营销</td>
			<td>
				{{ creditSetting[tactics.activity].title }}
			</td>
			<td class="text-center">
				<a href="javascript:;" ng-click="editCreditTactics('activity')">更改</a>
			</td>
		</tr>
		<tr>
			<td >交易和支付(余额)</td>
			<td>
				{{ creditSetting[tactics.currency].title }}
			</td>
			<td class="text-center">
				<a href="javascript:;" ng-click="editCreditTactics('currency')">更改</a>
			</td>
		</tr>
	</table>

	<div class="modal fade" id="credit-name" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="we7-modal-dialog modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
					<div class="modal-title">设置积分名称</div>
				</div>
				<div class="modal-body">
					<div class="we7-form">
						<div class="form-group">
							<div class="form-controls col-sm-10">
								<input type="text" name="" class="form-control" ng-model="creditTitle" placeholder="输入积分名称" ng-model="paysetting.alipay.partner">
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" ng-click="setCreditName(key)" data-dismiss="modal">确定</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="tactics" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="we7-modal-dialog modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
					<div class="modal-title">设置积分策略</div>
				</div>
				<div class="modal-body">
					<div class="we7-form">
						<div class="form-group">
							<div class="form-controls col-sm-10">
								<select ng-model="tactics.activity" ng-if="activeTacticsType == 'activity'" class="form-control">
									<option ng-repeat="credit in enabledCredit" value="{{ credit }}" ng-selected="credit == tactics.activity">{{ creditSetting[credit].title }}</option>
								</select>

								<select ng-model="tactics.currency" ng-if="activeTacticsType == 'currency'" class="form-control">
									<option ng-repeat="credit in enabledCredit" value="{{ credit }}" ng-selected="credit == tactics.currency">{{ creditSetting[credit].title }}</option>
								</select>
							</div>
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" ng-click="setCreditTactics()" data-dismiss="modal">确定</button>
				</div>
			</div>
		</div>
	</div>

</div>

<script>
	angular.module('profileApp').value('config', {
		'creditSetting' : {php echo json_encode($credit_setting)},
		'enabledCredit' : {php echo json_encode($enable_credit)},
		'activity' : "{$credit_tactics['activity']}",
		'currency' : "{$credit_tactics['currency']}",
		'saveCreditSetting' : "{php echo url('profile/passport/save_credit_setting')}",
		'saveTacticsSetting' : "{php echo url('profile/passport/save_tactics_setting')}"
	});
	angular.bootstrap($('#js-profile-credit'), ['profileApp']);
</script>

{/if}
{template 'common/footer'}

