{template 'common/header'}
<div class="we7-page-title">公众号管理</div>
<ul class="we7-page-tab">
	<li class="active"><a href="{url 'account/manage'}">公众号列表</a></li>
	<li><a href="{url 'account/recycle'}">公众号回收站</a></li>
</ul>
<div class="clearfix we7-margin-bottom">
	<form action="" class="form-inline  pull-left" method="get">
		<input type="hidden" name="c" value="account">
		<input type="hidden" name="a" value="manage">
		<div class="input-group form-group" style="width: 400px;">
			<input type="text" name="keyword" value="{$_GPC['keyword']}" class="form-control" placeholder="搜索关键字"/>
			<span class="input-group-btn"><button class="btn btn-default"><i class="fa fa-search"></i></button></span>
		</div>
	</form>
	{if (!empty($_W['allroles']) && (in_array('owner', $_W['allroles']) || in_array('manager', $_W['allroles']))) || $_W['isfounder']}
	<div class="pull-right">
		<a href="{url 'account/post-step'}" class="btn btn-primary we7-padding-horizontal">添加公众号</a>
	</div>
	{/if}
</div>                                                                                              
<table class="table we7-table table-hover vertical-middle" id="js-system-account-display" ng-controller="SystemAccountDisplay" ng-cloak>
	<col width="85px" />
	<col />
	<col width="208px" />
	<col width="100px"/>
	<col width="245px" />
	<tr>
		<th colspan="2" class="text-left">公众号</th>
		<th>有效期</th>
		<th>短信数(条)</th>
		<th class="text-left">操作</th>
	</tr>
	<tr class="color-gray" ng-repeat="list in lists">
		<td class="text-left">
			<img ng-src="{{list.thumb}}" class="img-responsive">
		</td>
		<td class="text-left">
			<p class="color-dark" ng-bind="list.name"></p>
			<span class="color-gray" ng-if="list.level == 1">类型：普通订阅号</span>
			<span class="color-gray" ng-if="list.level == 2">类型：普通服务号</span>
			<span class="color-gray" ng-if="list.level == 3">类型：认证订阅号</span>
			<span class="color-gray" ng-if="list.level == 4">类型：认证服务号</span>
			<span class="color-red" ng-if="list.isconnect == 0" data-toggle="tooltip" data-placement="right" title="公众号接入状态显示“未接入”解决方案：进入微信公众平台，依次选择: 开发者中心 -> 修改配置，然后将对应公众号在平台的url和token复制到微信公众平台对应的选项，公众平台会自动进行检测"><i class="wi wi-error-sign"></i>未接入</span>
			<span class="color-green" ng-if="list.isconnect == 1"><i class="wi wi-right-sign"></i>已接入</span>
		</td>
		<td>
			<p ng-bind="list.setmeal.timelimit"></p>
		</td>
		<td><p ng-bind="list.sms"></p></td>
		<td class="text-left vertical-middle">
			<div class="link-group">
				<a ng-href="{{links.switch}}uniacid={{list.uniacid}}">进入公众号</a>
				{if (!empty($_W['allroles']) && (in_array('owner', $_W['allroles']) || in_array('manager', $_W['allroles']))) || $_W['isfounder']}
				<a ng-href="{{links.post}}acid={{list.acid}}&uniacid={{list.uniacid}}">管理设置</a>
				<a ng-href="{{links.del}}acid={{list.acid}}&uniacid={{list.uniacid}}" onclick="if(!confirm('确认放入回收站吗？')) return false;">停用</a>
				{/if}
			</div>
		</td>
	</tr>
</table>
<div class="pull-right">
	{$pager}
</div>
<script>
	$(function(){
		$('[data-toggle="tooltip"]').tooltip();
	});
	angular.module('accountApp').value('config', {
		lists: {php echo !empty($list) ? json_encode($list) : 'null'},
		links: {
			switch: "{php echo url('account/display/switch')}",
			post: "{php echo url('account/post')}",
			del: "{php echo url('account/manage/delete')}",
		}
	});
	angular.bootstrap($('#js-system-account-display'), ['accountApp']);
</script>
{template 'common/footer'}